- name: Sync all branches with main
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "Bot de Sincronización"
          
          # 1. Traer información de todas las ramas remotas
          git fetch --all

          # 2. Listar ramas remotas de forma limpia y recorrerlas
          # Este comando ignora main y la referencia HEAD
          for remote_branch in $(git branch -r | grep 'origin/' | grep -v 'origin/main' | grep -v 'HEAD'); do
            
            # Limpiamos el nombre para quitar el "origin/"
            branch=${remote_branch#origin/}
            
            echo "--- Intentando sincronizar: $branch ---"
            
            # Creamos la rama local siguiendo a la remota y cambiamos a ella
            git checkout -B $branch $remote_branch
            
            # Intentamos la fusión
            if git merge origin/main; then
              # Si no hay conflictos, subimos los cambios
              git push origin $branch
              echo "✅ $branch sincronizada."
            else
              # Si hay conflicto, cancelamos ese merge y seguimos con la siguiente
              echo "❌ Conflicto en $branch. Saltando..."
              git merge --abort
            fi
          done
